{"version":3,"file":"checkAuth.js","sourceRoot":"","sources":["../../src/middlewares/checkAuth.ts"],"names":[],"mappings":";;;;;;AAEA,8DAA+B;AAExB,IAAM,QAAQ,GAAG,UAAC,GAAuB,EAAE,GAAa,EAAE,IAAkB;IAClF,IAAI;QACH,6DAA6D;QAC7D,IAAI,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QACtC,IAAI,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC;QACtC,IAAG,KAAK,IAAI,KAAK,CAAC,UAAU,CAAC,SAAS,CAAC,EAAC;YACvC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;SAC5B;QACD,IAAM,OAAO,GAAG,sBAAG,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACvD,uBAAuB;QACvB,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC;QACtB,IAAI,EAAE,CAAC;KACP;IAAC,OAAM,CAAC,EAAE;QACV,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACf,OAAO,GAAG,CAAC,UAAU,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,aAAa,EAAE,CAAC,CAAC;KACvD;AACF,CAAC,CAAA;AAhBY,QAAA,QAAQ,YAgBpB","sourcesContent":["import { Response, NextFunction } from 'express';\r\nimport { RequestWithDecoded } from '../interfaces';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nexport const chatAuth = (req: RequestWithDecoded, res: Response, next: NextFunction)=>{\r\n\ttry {\r\n\t\t//req.headers['x-access-token'] || req.headers.authorization;\r\n\t\tlet t = req.headers['x-access-token'];\r\n\t\tlet token = req.headers.authorization;\r\n\t\tif(token && token.startsWith('Bearer ')){\r\n\t\t\ttoken = token.split(' ')[1];\r\n\t\t}\r\n\t\tconst decoded = jwt.verify(token, process.env.JWT_KEY);\r\n\t\t//console.log(decoded);\r\n\t\treq.decoded = decoded;\r\n\t\tnext();\r\n\t} catch(e) {\r\n\t\tconsole.log(e);\r\n\t\treturn res.statusJson(401, { message: 'Auth failed' });\r\n\t}\r\n}"]}